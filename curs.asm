.386
.model small
.stack 100h
.data
    m dw 2                 ; ???????
    pi dd 3.14159265359    ; ????? ??
    sphere_x dw 144 dup(?) ; ?????????? X
    sphere_y dw 144 dup(?) ; ?????????? Y
    sphere_z dw 144 dup(?) ; ?????????? Z
    white db 15            ; ????? ???? (??? ???????????)
.code
main proc
    ; ?????????? ??????????? ?????
    mov ax, 4F02h
    mov bx, 103h
    int 10h
    ; ????????????? ?????
    call MakeSphere
    ; ??????????? ?????
    call DrawSphere
    ; ???????? ??????? ???????
    mov ah, 0
    int 16h
    ; ????? ?? ?????????
    mov ax, 4C00h
    int 21h
main endp
;--------------------------------------
; ????????? ???????? ?????
;--------------------------------------
MakeSphere proc
    push ax
    push bx
    push cx
    push dx
    push si
    ; ???? q ? q1 ??? ??????? ?????????
    fldpi                   ; q1 = -pi/2
    fld st(0)
    fdiv dword ptr [pi]
    fld1
    fchs
    faddp st(1), st         ; q1 = -pi/2 + pi/10
    mov si, 0               ; ?????? ?????????
    xor cx, cx              ; ??????? ?????
sphere_level:
    fldpi                   ; q = 0
    xor bx, bx              ; ???? ??? ???????? ??????
sphere_angle:
    ; ?????? X, Y, Z
    fld st(0)               ; q (????)
    fcos                    ; cos(q)
    fld st(1)               ; q1 (????)
    fcos                    ; cos(q1)
    fmulp st(1), st         ; cos(q) * cos(q1)
    fimul dword ptr m       ; ???????????????
    fistp sphere_x[si]      ; ????????? X
    fld st(0)               ; q
    fsin                    ; sin(q)
    fld st(2)               ; q1
    fcos                    ; cos(q1)
    fmulp st(1), st         ; sin(q) * cos(q1)
    fimul dword ptr m
    fistp sphere_y[si]      ; ????????? Y
    fld st(0)               ; q1
    fsin                    ; sin(q1)
    fimul dword ptr m
    fistp sphere_z[si]      ; ????????? Z
    ; ???????? ???? q
    fldpi
    fld st(0)
    fdiv dword ptr [pi]
    faddp st(1), st         ; q = q + pi/7.5
    inc si
    inc bx
    cmp bx, 16              ; ????????? 16 ???
    jl sphere_angle
    ; ???????? ??????? q1
    fldpi
    fld st(0)
    fdiv dword ptr [pi]
    faddp st(1), st         ; q1 = q1 + pi/10
    inc cx
    cmp cx, 5               ; ????? 5 ???????
    jl sphere_level
    ; ??????? ????? FPU
    finit
    pop si
    pop dx
    pop cx
    pop bx
    pop ax
    ret
MakeSphere endp
;--------------------------------------
; ????????? ????????? ?????
;--------------------------------------
DrawSphere proc
    push si
    push ax
    push bx
    push cx
    push dx
    mov si, 0
draw_loop:
    ; ?????????? ?????? ?????????
    mov ax, sphere_x[si]
    add ax, 400
    mov cx, ax
    mov ax, sphere_y[si]
    add ax, 300
    mov dx, ax
    ; ????? ?????? ???????
    mov al, white
    mov ah, 0Ch
    int 10h
    add si, 2
    cmp si, 288            ; ????? 144 ?????
    jl draw_loop
    pop dx
    pop cx
    pop bx
    pop ax
    pop si
    ret
DrawSphere endp
end main
